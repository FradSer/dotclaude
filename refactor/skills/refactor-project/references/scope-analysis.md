# Project Scope Analysis Details

## File Discovery Strategies

### Primary Glob Patterns

Use language-specific patterns to discover all code files:

**JavaScript/TypeScript**:
```
**/*.{ts,tsx,js,jsx,mjs,cjs}
```

**Python**:
```
**/*.py
```

**Go**:
```
**/*.go
```

**Swift**:
```
**/*.swift
```

**Multi-language projects**:
Combine patterns or run multiple Glob searches.

### Exclusion Patterns

**ALWAYS exclude these directories**:
- `node_modules/`, `.pnpm/`, `bower_components/`
- `.git/`, `.svn/`, `.hg/`
- `dist/`, `build/`, `out/`, `.next/`, `.nuxt/`
- `vendor/`, `venv/`, `.venv/`, `__pycache__/`
- `target/` (Rust), `bin/`, `obj/` (C#)
- `coverage/`, `.nyc_output/`

**ALWAYS exclude these files**:
- Lock files: `package-lock.json`, `pnpm-lock.yaml`, `yarn.lock`, `Gemfile.lock`, `Cargo.lock`, `go.sum`, `uv.lock`
- Compiled/minified: `*.min.js`, `*.bundle.js`, `*.d.ts` (unless project uses them as source)
- Binary/media: `*.png`, `*.jpg`, `*.pdf`, `*.woff`, `*.ttf`
- Generated code: Files with `// @generated` or similar markers

**Configuration files** (include selectively):
- Include: `.eslintrc.js`, `jest.config.ts` (executable code)
- Exclude: `.json`, `.yaml`, `.toml` config files (unless code-like)

### File Categorization

After discovery, categorize files for summary:

**By Language**:
```
TypeScript: 45 files
Python: 12 files
Go: 8 files
```

**By Purpose**:
```
Source code: 52 files
Tests: 13 files
```

**By Directory**:
```
src/: 30 files
lib/: 15 files
tests/: 13 files
scripts/: 7 files
```

## Project Structure Analysis

### Directory Tree Generation

Generate a high-level overview:

```
src/
├── components/ (15 files)
├── services/ (8 files)
├── utils/ (7 files)
└── types/ (5 files)
tests/ (13 files)
scripts/ (7 files)
```

### Framework Detection

Detect project type by inspecting key files:

**Next.js**:
- `next.config.js` exists
- `pages/` or `app/` directory
- `package.json` contains `"next"`

**React**:
- `package.json` contains `"react"`
- `.tsx`/`.jsx` files present

**Python**:
- `pyproject.toml`, `setup.py`, `requirements.txt`
- `uv.lock` for uv-based projects

**Go**:
- `go.mod` exists

**Swift**:
- `.xcodeproj` or `Package.swift`

Include framework information in scope summary.

## Scope Summary Display Format

### Standard Format

```
Project-wide Refactoring Scope:

Files to refactor: <total count>

Languages detected:
- <language1>: <count> files
- <language2>: <count> files

Frameworks detected:
- <framework1>
- <framework2>

Main directories:
- <dir1>/: <count> files
- <dir2>/: <count> files

Proceeding with project-wide refactoring automatically.
```

### Example

```
Project-wide Refactoring Scope:

Files to refactor: 65

Languages detected:
- TypeScript: 45 files
- Python: 12 files
- Shell: 8 files

Frameworks detected:
- Next.js
- React

Main directories:
- src/: 35 files
- lib/: 10 files
- scripts/: 8 files
- tests/: 12 files

Proceeding with project-wide refactoring automatically.
```

## Edge Cases

### Monorepo Projects

For monorepos with multiple packages:

**Strategy**:
1. Detect monorepo structure (`packages/`, `apps/`)
2. Optionally group by package in summary
3. Refactor all packages in single pass
4. Note monorepo structure in scope summary

**Example**:
```
Monorepo detected with 3 packages:
- packages/core/: 25 files
- packages/ui/: 18 files
- apps/web/: 22 files
```

### Mixed Source and Generated Code

When project contains both source and generated files:

**Detection**:
- Check for `// @generated`, `# generated by`, or similar markers
- Look for common codegen directories (`__generated__/`, `.graphql/`)

**Strategy**:
- Exclude generated files from refactoring scope
- Note exclusion in scope summary

### Test-Heavy Projects

When test files outnumber source files:

**Strategy**:
- Categorize separately in summary
- Proceed with refactoring both source and tests
- Note test ratio in scope display

**Example**:
```
Files to refactor: 85
- Source code: 32 files
- Tests: 53 files (62% of project)
```

### Empty or Minimal Projects

If discovered files < 5:

**Strategy**:
- Display scope summary
- Proceed with refactoring
- Note in summary: "Small project scope detected"

### Very Large Projects

If discovered files > 500:

**Strategy**:
- Still refactor all files (no arbitrary limits)
- In scope summary, note: "Large project detected"
- Inform user that refactoring may take significant time
- Suggest reviewing changes in logical groups afterward

## Validation and Safety

### Pre-Flight Checks

Before displaying scope summary:

1. **Verify repository root**: Ensure running within git repository
2. **Check working tree**: Warn if uncommitted changes exist (but still proceed)
3. **Validate file access**: Ensure discovered files are readable

### Working Tree Warning

If uncommitted changes detected:

```
⚠️  Warning: Uncommitted changes detected in working tree.
Project-wide refactoring will modify files across the entire codebase.
Recommend committing or stashing changes first.

Continue automatically in 3 seconds, or Ctrl+C to cancel...
```

Wait 3 seconds, then proceed automatically.

### Git Repository Check

If not in a git repository:

```
❌ Error: Not in a git repository.
Project-wide refactoring requires git for safety (rollback capability).
Initialize git first: git init
```

Exit without refactoring.
